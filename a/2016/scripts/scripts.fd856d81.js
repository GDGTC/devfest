"use strict";angular.module("devfestApp",["ngAnimate","ngCookies","ngResource","ngRoute","ui.router","ngSanitize","ngTouch","firebase","firebase.ref","firebase.auth","ngMap","angular.filter","ui.bootstrap","ngOpbeat"]),angular.module("devfestApp").factory("Config",function(){return{name:"GDG Twin Cities",location:"Minneapolis St. Paul Metro",email:"gdgtwincities@gmail.com",id:"105771089293763738926",googleAPI:"AIzaSyB3g3Fr3M56bILSK2aqn6arqU1CQt1zb3E",website:"http://gdgtc.com",allowRegister:!0,eventName:"DevFestMN",eventLocation:"Schulze Hall, University of St. Thomas",eventAddress:"46 S. 11th St. Minneapolis, MN",eventURL:"http://devfest.mn",eventEmail:"info@devfest.mn",speakerURL:"http://goo.gl/forms/F6w1PNQNr7",sponsorURL:"https://docs.google.com/forms/d/1tL-ovRrdSCdAENnbkWSiF3OaRlkbmdzvhzNCNs_n9SU/viewform",sponsorLevelLinkFromMainPage:!1,ticketURL:"http://devfestmn.eventbrite.com/?aff=devfestmnwebsite",eventDate:"2016-02-06",eventStart:"08:00:00",eventEnd:"16:00:00",sessionLength:"2700000",sessionTracks:"6",twitter:"gdgtc",facebook:"gdgtwincities",meetup:"gdg-tc",github:"GDGTC"}}),angular.module("devfestApp").config(["$routeProvider","$locationProvider","$stateProvider","$urlRouterProvider","$opbeatProvider",function(a,b,c,d,e){b.html5Mode(!0),d.otherwise("/"),c.state("main",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl"}).state("schedule",{url:"/schedule",templateUrl:"views/schedule.html",controller:"ScheduleCtrl"}).state("feedback",{url:"/feedback/:sessionId",templateUrl:"views/feedback.html",controller:"FeedbackCtrl"}).state("schedule.modal",{url:"/:sessionId",onEnter:["$stateParams","$state","$uibModal",function(a,b,c){return""===a.sessionId?void b.go("schedule"):void c.open({templateUrl:"views/schedule-session.html",controller:"SessionModalCtrl"}).result.then(function(a){b.go("schedule")},function(a){"speakerForward"===a.action?b.go("speakers.modal",{speakerId:a.id}):"feedbackForward"===a.action?b.go("feedback",{sessionId:a.id}):b.go("schedule")})}]}).state("schedule-edit",{url:"/schedule-edit",templateUrl:"views/schedule-edit.html",controller:"ScheduleEditCtrl"}).state("speakers",{url:"/speakers",templateUrl:"views/speakers.html",controller:"SpeakersCtrl"}).state("speakers.modal",{url:"/:speakerId",onEnter:["$stateParams","$state","$uibModal",function(a,b,c){return""===a.speakerId?(console.log("Cannot visit an empty speaker."),void b.go("speakers")):void c.open({templateUrl:"views/speakers-view.html",controller:"SpeakerModalCtrl"}).result.then(function(){b.go("speakers")},function(a){"sessionForward"===a.action?b.go("schedule.modal",{sessionId:a.id}):b.go("speakers")})}]}).state("sponsorship",{url:"/sponsorship",templateUrl:"views/sponsorship.html",controller:"SponsorshipCtrl"}).state("about",{url:"/about",templateUrl:"views/about.html",controller:"AboutCtrl"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("account",{url:"/account",templateUrl:"views/account.html",controller:"AccountCtrl"}),e.config({debug:!1,orgId:"411adc346fa34378a00c88e9de15c529",appId:"ddab509ec6"})}]).run(["$rootScope","$location","$window",function(a,b,c){a.$on("$stateChangeSuccess",function(){c.ga&&c.ga("send","pageview",{page:b.path()}),c.sp&&c.sp("trackPageView",b.protocol()+"//"+b.host()+b.path())})}]),angular.module("devfestApp").factory("Rooms",function(){var a={namedRoomList:{auditorium:"Main Auditorium",smallauditorium:"Small Auditorium",lab:"Laboratory Classroom (3rd Floor)",classroom1:"Classroom A (3rd Floor)",classroom2:"Classroom B (3rd Floor)",classroom3:"Classroom C (3rd Floor)"}};return a}),function(){angular.module("firebase.auth",["firebase","firebase.ref"]).factory("Auth",["$firebaseAuth","Ref","$firebaseArray",function(a,b,c){var d=a(b);return d}])}(),angular.module("firebase.config",[]).constant("FBURL","https://devfestmn.firebaseio.com").constant("SIMPLE_LOGIN_PROVIDERS",["password","google"]).constant("loginRedirectPath","/login"),angular.module("firebase.ref",["firebase","firebase.config"]).factory("Ref",["$window","FBURL",function(a,b){return new a.Firebase(b)}]),angular.module("devfestApp").directive("ngShowAuth",["Auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuth(e),e()}}}]),angular.module("devfestApp").directive("ngShowAdmin",["Auth","Ref","$firebaseObject","$timeout",function(a,b,c,d){return{restrict:"A",link:function(e,f){function g(){d(function(){var d=a.$getAuth(),e=!1;if(f.toggleClass("ng-cloak",!e),d){var g=c(b.child("admin/"+d.uid));g.$loaded().then(function(){g.$value&&(e=!0,f.toggleClass("ng-cloak",!e))})}},0)}f.addClass("ng-cloak"),a.$onAuth(g),g()}}}]),angular.module("devfestApp").directive("ngHideAuth",["Auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuth(e),e()}}}]),angular.module("devfestApp").directive("modal",function(){return{template:'<div class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">{{ title }}</h4></div><div class="modal-body" ng-transclude></div></div></div></div>',restrict:"E",transclude:!0,replace:!0,scope:!0,link:function(a,b,c){a.title=c.title,a.$watch(c.visible,function(a){a===!0?$(b).modal("show"):$(b).modal("hide")}),$(b).on("shown.bs.modal",function(){a.$apply(function(){a.$parent[c.visible]=!0})}),$(b).on("hidden.bs.modal",function(){a.$apply(function(){a.$parent[c.visible]=!1})})}}}),angular.module("devfestApp").filter("levelSorter",function(){function a(a){switch(a){case"Gold":return 1;case"Silver":return 2;case"Bronze":return 3}}return function(b,c){var d=[];return angular.forEach(b,function(a){d.push(a)}),d.sort(function(b,c){return a(b.level)>a(c.level)?1:-1}),d}}),angular.module("devfestApp").controller("HeaderCtrl",["$scope","$location","Config",function(a,b,c){a.site=c,a.isActive=function(a){return a===b.path()}}]),angular.module("devfestApp").controller("FooterCtrl",["$scope","$window","$timeout","Config",function(a,b,c,d){a.site=d,a.socialLink=function(a){var c="";switch(a){case"google_plus":c="https://plus.google.com/"+d.id;break;case"facebook":c="https://www.facebook.com/"+d.facebook;break;case"twitter":c="https://twitter.com/"+d.twitter;break;case"github":c="https://github.com/"+d.github;break;case"meetup":c="http://www.meetup.com/"+d.meetup}return b.open(c,"_blank"),!1},c(function(){gapi.plusone.go()},1e3)}]),angular.module("devfestApp").controller("MainCtrl",["$scope","$http","$window","$location","Config",function(a,b,c,d,e){function f(a){var b=a.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);return b?new Date(b[1],b[2]-1,b[3]):new Date}a.site=e,a.gMapLazy="https://maps.google.com/maps/api/js",a.gMapURL="https://maps.google.com/maps/api/js?client="+e.googleAPI;var g=e.eventStart.substring(0,e.eventStart.indexOf(":")),h=e.eventStart.substring(e.eventStart.indexOf(":")+1,e.eventStart.indexOf(":")+3),i=e.eventEnd.substring(0,e.eventEnd.indexOf(":")),j=e.eventEnd.substring(e.eventEnd.indexOf(":")+1,e.eventEnd.indexOf(":")+3),k=f(e.eventDate);a.eventStart=new Date(k.getFullYear(),k.getMonth(),k.getDate(),g,h,0),a.eventEnd=new Date(k.getFullYear(),k.getMonth(),k.getDate(),i,j,0);var l=function(b){var c=b.data;"OK"===c.status&&(a.map={lat:c.results[0].geometry.location.lat,lng:c.results[0].geometry.location.lng,zoom:16,center:{lat:c.results[0].geometry.location.lat+.002,lng:c.results[0].geometry.location.lng}})},m=function(a){console.error(a)};e.eventAddress.length>0&&b.get("https://maps.googleapis.com/maps/api/geocode/json?address="+e.eventAddress.replace(/\s/g,"+").replace(/,/g,"")+"&key="+e.googleAPI).then(l,m),a.gaClick=function(a,b,d,e){c.ga("send","event",a,b,d,e)}}]),angular.module("devfestApp").controller("LoginCtrl",["$scope","Auth","$location","$q","Ref","$firebaseObject","$timeout","Config","$state",function(a,b,c,d,e,f,g,h,i){function j(a){var b=e.child("users/"+a.uid),c=d.defer();return b.set(a,function(a){g(function(){a?c.reject(a):c.resolve(b)})}),c.promise}a.googleLogin=function(){var a="google",c={scope:"email"};console.log("Logging in Google."),b.$authWithOAuthPopup(a,c).then(function(a){console.log(a),j(a),i.go("schedule")},function(a){console.log(a)})}}]),angular.module("devfestApp").controller("AccountCtrl",["$scope","Auth","Ref","$firebaseObject","$timeout","$state",function(a,b,c,d,e,f){a.user=b.$getAuth(),a.logout=function(){b.$unauth(),f.go("schedule")},a.messages=[],console.log(b)}]),angular.module("devfestApp").controller("ScheduleCtrl",["$scope","Auth","Ref","Rooms","$firebaseArray","$firebaseObject",function(a,b,c,d,e,f){var g=b.$getAuth();g&&g.uid&&(a.agenda=f(c.child("users").child(g.uid).child("/agendas/2016"))),a.schedule=e(c.child("devfest2016").child("schedule")),a.speakersAsObject=f(c.child("devfest2016").child("speakers")),a.rooms=d.namedRoomList,a.schedule.$watch(function(){console.log("Schedule data changed, reprocessing.");var b,c;for(c={},b=8;b<=17;b++){c[b]={all:[]};for(var d in a.rooms)c[b][d]=[]}for(a.orphans=[],b=a.schedule.length-1;b>=0;b--){var e=a.schedule[b],f=new Date(e.startTime).getUTCHours();f-=6,e.all?c[f]&&c[f].all.push(e):e.room&&c[f]&&c[f][e.room]&&0===c[f][e.room].length?c[f][e.room].push(e):(console.log("Room "+e.room+" didn't exist or"),console.log("Hour "+f+" didn't match our schedule"),a.orphans.push(e))}a.prettySchedule=c}),a.openFormModal=function(b){console.log("Modal is now open with ",b),a.session=b}}]),angular.module("devfestApp").controller("FeedbackCtrl",["$scope","Auth","Rooms","$state","$stateParams","$firebaseArray","$firebaseObject","Ref",function(a,b,c,d,e,f,g,h){if(a.user=b.$getAuth(),a.user&&a.user.uid){var i=g(h.child("feedback/2016/").child(a.user.uid).child(e.sessionId));i.$bindTo(a,"sessionFeedback");var j=g(h.child("users").child(a.user.uid).child("details"));j.$bindTo(a,"userDetails")}if(e.sessionId.length>0&&(a.session=g(h.child("devfest2016").child("schedule").child(e.sessionId)),a.speakersAsObject=g(h.child("devfest2016").child("speakers")),a.user&&a.user.uid)){var k=g(h.child("users").child(a.user.uid).child("/agendas/2016").child(e.sessionId));k.$bindTo(a,"favorite")}a.rooms=c.roomNameList}]),angular.module("devfestApp").controller("SessionModalCtrl",["$scope","$uibModalInstance","Auth","Rooms","$state","$stateParams","$firebaseArray","$firebaseObject","Ref",function(a,b,c,d,e,f,g,h,i){if(a.user=c.$getAuth(),a.categories="android, chromeweb, design, cloud, iot, reach",a.speakers=g(i.child("devfest2016").child("speakers")),a.speakersAsObject=h(i.child("devfest2016").child("speakers")),a.rooms=d.namedRoomList,a.cancel=function(){b.dismiss("cancel")},"new"===f.sessionId)a.editMode=!0,a.session={};else{if(!(f.sessionId&&f.sessionId.length>0))return console.log("Leaving the page because we could not find a session ID."),void a.cancel();if(a.session=h(i.child("devfest2016").child("schedule").child(f.sessionId)),a.user&&a.user.uid){var j=h(i.child("users").child(a.user.uid).child("/agendas/2016").child(f.sessionId));j.$bindTo(a,"favorite")}}a.viewSpeaker=function(a){b.dismiss({action:"speakerForward",id:a})},a.giveFeedback=function(){b.dismiss({action:"feedbackForward",id:f.sessionId})},a.saveSession=function(b){b.$id?(console.log("Updating session."),b.$save()):(console.log("Creating new session."),a.sessions=g(i.child("devfest2016").child("schedule")),a.sessions.$add(b)),a.cancel()},a.deleteSession=function(b){window.confirm("Are you sure you want to delete this session?")&&(console.log("Deleting session with ID ",b.$id),b.$remove(),a.cancel())},a.addSpeaker=function(a,b){var c=g(i.child("devfest2016/schedule").child(a.$id).child("speakers"));c.$add(b)},a.removeSpeaker=function(a,b){if(a.$id&&window.confirm("Are you sure you want to remove this speaker from this session?")){console.log("Deleting "+b+"from session "+a.$id);var c=h(i.child("devfest2016/schedule/").child(a.$id).child("speakers").child(b));c.$remove()}}}]),angular.module("devfestApp").controller("SpeakersCtrl",["$scope","Ref","$firebaseArray","$firebaseObject","$timeout","$uibModal","$window","$location","Config",function(a,b,c,d,e,f,g,h,i){a.site=i,a.speakers=c(b.child("devfest2016").child("speakers"))}]),angular.module("devfestApp").controller("SpeakerModalCtrl",["$scope","Ref","$window","$uibModalInstance","$firebaseObject","$firebaseArray","$stateParams",function(a,b,c,d,e,f,g){if(a.speakers=f(b.child("devfest2016").child("speakers")),a.err=null,a.sessions=[],a.cancel=function(){d.dismiss("cancel")},"new"===g.speakerId)a.editMode=!0,a.speaker={};else{if(!(g.speakerId&&g.speakerId.length>0))return console.log("Leaving the page because we could not find a speaker ID."),void a.cancel();a.speaker=e(b.child("devfest2016/speakers").child(g.speakerId))}var h=b.child("devfest2016/schedule");h.on("child_added",function(b){if(b.val().speakers)for(var c in b.val().speakers)g.speakerId===b.val().speakers[c]&&a.sessions.push(e(h.child(b.key())))}),a.saveSpeaker=function(){var c=a.speaker;a.imageData&&(c.image=a.imageData);var e;c.image&&c.image!==!0&&(e=c.image,c.image=!0,console.log("Removing speaker image while saving"));var f;if(c&&c.$id)f=c.$save();else{if(!c)return void(a.err="Please fill out the form or click Cancel to close.");f=a.speakers.$add(c)}c.image&&e&&f.then(function(a){var c=a.key(),d=b.child("/images/devfest2016/speakers/"+c);d.set(e)}),d.close()},a.$watch("speakerForm",function(){document.getElementById("image").addEventListener("change",a.handleImageAdd,!1)},!0),a.handleImageAdd=function(b){var c=b.target.files[0],d=new FileReader;d.onload=function(){return function(b){var c=b.target.result;a.imageData=c}}(c),d.readAsDataURL(c)},a.deleteSpeaker=function(){var b=a.speaker;window.confirm("Are you sure you want to delete this speaker?")&&(console.log("Deleting speaker with ID ",b.$id),b.$remove(),d.close())},a.socialLink=function(a,b){var d="";switch(a){case"google_plus":d="https://plus.google.com/"+b;break;case"facebook":d="https://www.facebook.com/"+b;break;case"twitter":d="https://twitter.com/"+b;break;case"github":d="https://github.com/"+b}return c.open(d,"_blank"),!1},a.viewSession=function(a){d.dismiss({action:"sessionForward",id:a})}}]),angular.module("devfestApp").controller("AboutCtrl",["$scope","$http","$timeout","$location","$sce","$window","Config",function(a,b,c,d,e,f,g){a.loading=!0,b.jsonp("https://www.googleapis.com/plus/v1/people/"+g.id+"?callback=JSON_CALLBACK&fields=aboutMe%2Ccover%2Cimage%2CplusOneCount%2Curls&key="+g.googleAPI).success(function(b){a.desc=b.aboutMe,e.trustAsHtml(a.desc);for(var d=[],f=0;f<b.urls.length;f++){var g=b.urls[f];if("Organizer"===g.label.substring(0,9)){var h={link:g.value};d.push(h)}}a.organizers=d,c(function(){gapi.person.go()}),a.loading=!1}).error(function(){a.desc="Sorry, we failed to retrieve the About text from the Google+ API.",a.loading=!1})}]),angular.module("devfestApp").controller("SponsorshipCtrl",["$scope","Ref","$firebaseArray","$timeout","$uibModal","$window","$location","Config",function(a,b,c,d,e,f,g,h){function i(a){var b=a.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);return b?new Date(b[1],b[2]-1,b[3]):new Date}a.site=h,a.sponsors=c(b.child("sponsors"));var j=h.eventStart.substring(0,h.eventStart.indexOf(":")),k=h.eventStart.substring(h.eventStart.indexOf(":")+1,h.eventStart.indexOf(":")+3),l=h.eventEnd.substring(0,h.eventEnd.indexOf(":")),m=h.eventEnd.substring(h.eventEnd.indexOf(":")+1,h.eventEnd.indexOf(":")+3),n=i(h.eventDate);a.eventStart=new Date(n.getFullYear(),n.getMonth(),n.getDate(),j,k,0),a.eventEnd=new Date(n.getFullYear(),n.getMonth(),n.getDate(),l,m,0),a.openFormModal=function(b){a.sponsor=b;var c=e.open({animation:!0,templateUrl:"modalSponsorForm.html",controller:"SponsorModalCtrl",resolve:{sponsor:function(){return a.sponsor}}});c.result.then(function(b){"add"===b.action?a.add(b.sponsor):"edit"===b.action&&a.edit(b.sponsor)})},a.add=function(b){a.sponsors.$add(b)},a.editSponsor=function(b){a.openFormModal(b)},a.edit=function(b){a.sponsors.$save(b)},a.deleteSponsor=function(b){confirm("Are you sure you want to delete this sponsor?")&&a.sponsors.$remove(b)}}]),angular.module("devfestApp").controller("SponsorModalCtrl",["$scope","$uibModalInstance","sponsor",function(a,b,c){a.sponsor=c,a.err=null,a.saveSponsor=function(c){c&&c.$id?(a.imageData&&(c.image=a.imageData),b.close({action:"edit",sponsor:c})):c?(a.imageData&&(c.image=a.imageData),b.close({action:"add",sponsor:c})):a.err="Please fill out the form or click Cancel to close."},a.handleImageAdd=function(b){var c=b.target.files[0],d=new FileReader;d.onload=function(b){return function(b){var c=b.target.result;a.imageData=c}}(c),d.readAsDataURL(c)},a.$watch("sponsorForm",function(){document.getElementById("image").addEventListener("change",a.handleImageAdd,!1)},!0),a.cancel=function(){b.dismiss("cancel")}}]);